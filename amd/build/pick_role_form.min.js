define(["jquery","core/notification","core/ajax"],function(a,b,c){"use strict";return{init:function(d,e){var f,g={contextlevel:a("#id_contextlevel"),role:a("#id_role"),instance:a("#id_instance")},h={submit:a("#id_submitbutton")},i={system:"10",user:"30",coursecat:"40",course:"50",module:"70",block:"80"},j=function(a){a.find("option").remove().end()},k=function(a){a.forEach(function(a){j(a)})},l=function(a){a.prop("disabled",!1),a.removeClass("disabled")},m=function(a){a.forEach(function(a){l(a)})},n=function(a){a.prop("disabled",!0),a.addClass("disabled")},o=function(a){a.forEach(function(a){n(a)})},p=function(b,c){c.forEach(function(c){b.append(a("<option>",{value:c.value,text:c.text}))}),b.trigger("change")},q=d.allcategories||"All course categories",r=d.allcourses||"All courses";f="assign"===e?"tool_userbulkrolechange_bulk_assign_role":"tool_userbulkrolechange_bulk_unassign_role";var s=function(){o([h.submit,g.role,g.instance]),k([g.role,g.instance]);var d,e,f,j,m=g.contextlevel.val();switch(m){case i.coursecat:d="tool_userbulkrolechange_get_all_course_categories",e="course_categories",f={value:-1,text:q};break;case i.course:d="tool_userbulkrolechange_get_all_courses",e="courses",f={value:-1,text:r};break;default:d=!1}j=[{methodname:"tool_userbulkrolechange_get_context_level_roles",args:{contextlevel:m}}],d&&j.push({methodname:d,args:{}});var n=c.call(j);n[0].then(function(a){a.roles&&(p(g.role,a.roles),l(g.role))},b.exception),d&&n[1].then(function(a){a[e]&&(a[e].unshift(f),p(g.instance,a[e]),l(g.instance))},b.exception),a.when.apply(a,n).done(function(){l(h.submit)})},t=function(){o([h.submit,g.contextlevel,g.role,g.instance]);var a=g.contextlevel.val(),d=g.role.val(),e=g.instance.val();return c.call([{methodname:f,args:{contextlevel:a,role:d,instance:e}}])[0].then(function(a){a.success,m([h.submit,g.contextlevel,g.role,g.instance])},b.exception),!1};g.contextlevel.on("change",s),h.submit.on("click",t),l(h.submit)}}});